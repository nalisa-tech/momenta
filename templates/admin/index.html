{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/payment_admin.css' %}">
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        .recent-activity {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .activity-item {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        .activity-item:last-child {
            border-bottom: none;
        }
    </style>
{% endblock %}

{% block content %}
<h1>ğŸ‰ Momenta Dashboard Overview</h1>

<!-- Key Metrics -->
<div class="dashboard-grid">
    <div class="metric-card" style="background: linear-gradient(135deg, #28a745, #20c997);">
        <div class="metric-value">K{{ total_revenue|floatformat:0 }}</div>
        <div class="metric-label">ğŸ’° Total Revenue</div>
    </div>
    
    <div class="metric-card" style="background: linear-gradient(135deg, #17a2b8, #138496);">
        <div class="metric-value">{{ total_bookings }}</div>
        <div class="metric-label">ğŸ« Total Bookings</div>
    </div>
    
    <div class="metric-card" style="background: linear-gradient(135deg, #ffc107, #e0a800);">
        <div class="metric-value">{{ pending_payments }}</div>
        <div class="metric-label">â³ Pending Payments</div>
    </div>
    
    <div class="metric-card" style="background: linear-gradient(135deg, #dc3545, #c82333);">
        <div class="metric-value">{{ upcoming_events }}</div>
        <div class="metric-label">ğŸ“… Upcoming Events</div>
    </div>
    
    <div class="metric-card" style="background: linear-gradient(135deg, #6f42c1, #5a32a3);">
        <div class="metric-value">{{ total_users }}</div>
        <div class="metric-label">ğŸ‘¥ Total Users</div>
    </div>
    
    <div class="metric-card" style="background: linear-gradient(135deg, #fd7e14, #e8590c);">
        <div class="metric-value">{{ new_users_this_week }}</div>
        <div class="metric-label">ğŸ†• New Users (7d)</div>
    </div>
</div>

<!-- Revenue Breakdown -->
<div class="recent-activity">
    <h2>ğŸ’° Revenue Breakdown</h2>
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; text-align: center;">
        <div>
            <h3 style="color: #28a745;">This Week</h3>
            <div style="font-size: 1.5em; font-weight: bold;">K{{ weekly_revenue|floatformat:0 }}</div>
        </div>
        <div>
            <h3 style="color: #17a2b8;">This Month</h3>
            <div style="font-size: 1.5em; font-weight: bold;">K{{ monthly_revenue|floatformat:0 }}</div>
        </div>
        <div>
            <h3 style="color: #6f42c1;">All Time</h3>
            <div style="font-size: 1.5em; font-weight: bold;">K{{ total_revenue|floatformat:0 }}</div>
        </div>
    </div>
</div>

<!-- Popular Events -->
<div class="recent-activity">
    <h2>ğŸ”¥ Most Popular Events</h2>
    {% for event in popular_events %}
    <div class="activity-item">
        <div>
            <strong>{{ event.title }}</strong><br>
            <small style="color: #666;">{{ event.date }} â€¢ {{ event.category.name }}</small>
        </div>
        <div style="text-align: right;">
            <div style="background: #17a2b8; color: white; padding: 4px 8px; border-radius: 10px; font-size: 12px;">
                {{ event.booking_count }} bookings
            </div>
        </div>
    </div>
    {% empty %}
    <p style="color: #666; text-align: center; padding: 20px;">No events with bookings yet.</p>
    {% endfor %}
</div>

<!-- Recent Activity -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <!-- Recent Bookings -->
    <div class="recent-activity">
        <h2>ğŸ“‹ Recent Bookings</h2>
        {% for booking in recent_bookings %}
        <div class="activity-item">
            <div>
                <strong>{{ booking.user.username }}</strong><br>
                <small style="color: #666;">{{ booking.event.title }} â€¢ {{ booking.get_ticket_type_display }}</small>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: bold; color: #28a745;">K{{ booking.total_price|floatformat:0 }}</div>
                <small style="color: #999;">{{ booking.booked_at|timesince }} ago</small>
            </div>
        </div>
        {% empty %}
        <p style="color: #666; text-align: center; padding: 20px;">No recent bookings.</p>
        {% endfor %}
    </div>
    
    <!-- Recent Payments -->
    <div class="recent-activity">
        <h2>ğŸ’³ Recent Payments</h2>
        {% for payment in recent_payments %}
        <div class="activity-item">
            <div>
                <strong>{{ payment.booking.user.username }}</strong><br>
                <small style="color: #666;">{{ payment.get_payment_method_display }} â€¢ {{ payment.transaction_id }}</small>
            </div>
            <div style="text-align: right;">
                {% if payment.status == 'completed' %}
                    <div style="background: #28a745; color: white; padding: 2px 6px; border-radius: 8px; font-size: 10px;">âœ… APPROVED</div>
                {% elif payment.status == 'pending' %}
                    <div style="background: #ffc107; color: white; padding: 2px 6px; border-radius: 8px; font-size: 10px;">â³ PENDING</div>
                {% elif payment.status == 'failed' %}
                    <div style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 8px; font-size: 10px;">âŒ FAILED</div>
                {% endif %}
                <small style="color: #999; display: block;">{{ payment.created_at|timesince }} ago</small>
            </div>
        </div>
        {% empty %}
        <p style="color: #666; text-align: center; padding: 20px;">No recent payments.</p>
        {% endfor %}
    </div>
</div>

<!-- Quick Actions -->
<div class="recent-activity">
    <h2>âš¡ Quick Actions</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <a href="/admin/events/event/add/" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 15px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: bold;">
            â• Add New Event
        </a>
        <a href="/admin/events/paymenttransaction/?status__exact=pending" style="background: linear-gradient(135deg, #ffc107, #e0a800); color: white; padding: 15px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: bold;">
            â³ Review Pending Payments
        </a>
        <a href="/admin/events/booking/" style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 15px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: bold;">
            ğŸ“‹ View All Bookings
        </a>
        <a href="/admin/events/venue/" style="background: linear-gradient(135deg, #6f42c1, #5a32a3); color: white; padding: 15px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: bold;">
            ğŸ¢ Manage Venues
        </a>
    </div>
</div>

<!-- Default Django Admin Content -->
{% if app_list %}
    {% for app in app_list %}
        <div class="app-{{ app.app_label }} module">
            <table>
                <caption>
                    <a href="{{ app.app_url }}" class="section" title="{% blocktrans with name=app.name %}Models in the {{ name }} application{% endblocktrans %}">{{ app.name }}</a>
                </caption>
                {% for model in app.models %}
                    <tr class="model-{{ model.object_name|lower }}">
                        {% if model.admin_url %}
                            <th scope="row"><a href="{{ model.admin_url }}">{{ model.name }}</a></th>
                        {% else %}
                            <th scope="row">{{ model.name }}</th>
                        {% endif %}

                        {% if model.add_url %}
                            <td><a href="{{ model.add_url }}" class="addlink">{% trans 'Add' %}</a></td>
                        {% else %}
                            <td>&nbsp;</td>
                        {% endif %}

                        {% if model.admin_url %}
                            {% if model.view_only %}
                                <td><a href="{{ model.admin_url }}" class="viewlink">{% trans 'View' %}</a></td>
                            {% else %}
                                <td><a href="{{ model.admin_url }}" class="changelink">{% trans 'Change' %}</a></td>
                            {% endif %}
                        {% else %}
                            <td>&nbsp;</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </table>
        </div>
    {% endfor %}
{% else %}
    <p>{% trans "You don't have permission to view or edit anything." %}</p>
{% endif %}
{% endblock %}