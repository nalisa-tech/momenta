{% extends 'base.html' %}
{% load static %}

{% block title %}Facilities Dashboard - Momenta{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header Section -->
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">ğŸ—ï¸ Facilities Management Dashboard</h1>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
            Real-time coordination of venues, resources, and event logistics across Zambia.
        </p>
    </div>

    <!-- Key Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-blue-100 text-sm">Available Venues</p>
                    <p class="text-3xl font-bold">{{ total_venues }}</p>
                </div>
                <div class="text-4xl opacity-80">ğŸ¢</div>
            </div>
        </div>

        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-green-100 text-sm">Available Resources</p>
                    <p class="text-3xl font-bold">{{ total_resources }}</p>
                </div>
                <div class="text-4xl opacity-80">ğŸ”§</div>
            </div>
        </div>

        <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-orange-100 text-sm">Venues Booked Today</p>
                    <p class="text-3xl font-bold">{{ venue_bookings_today }}</p>
                </div>
                <div class="text-4xl opacity-80">ğŸ“…</div>
            </div>
        </div>

        <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-purple-100 text-sm">Resources in Use</p>
                    <p class="text-3xl font-bold">{{ resource_allocations_today }}</p>
                </div>
                <div class="text-4xl opacity-80">âš¡</div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- Recent Venue Bookings -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ¢ Recent Venue Bookings</h2>
            {% if recent_venue_bookings %}
                <div class="space-y-4">
                    {% for booking in recent_venue_bookings %}
                    <div class="border-l-4 border-blue-500 pl-4 py-2">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-semibold text-gray-800">{{ booking.venue.name }}</h3>
                                <p class="text-sm text-gray-600">{{ booking.event.title }}</p>
                                <p class="text-xs text-gray-500">
                                    ğŸ“… {{ booking.start_datetime|date:"M d, Y" }} at {{ booking.start_datetime|time:"g:i A" }}
                                </p>
                            </div>
                            <div class="text-right">
                                <span class="px-2 py-1 text-xs rounded-full
                                    {% if booking.status == 'confirmed' %}bg-green-100 text-green-800
                                    {% elif booking.status == 'pending' %}bg-yellow-100 text-yellow-800
                                    {% else %}bg-gray-100 text-gray-800{% endif %}">
                                    {{ booking.get_status_display }}
                                </span>
                                <p class="text-sm font-semibold text-green-600 mt-1">K{{ booking.total_cost|floatformat:0 }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-8">No recent venue bookings</p>
            {% endif %}
        </div>

        <!-- Recent Resource Allocations -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ”§ Recent Resource Allocations</h2>
            {% if recent_resource_allocations %}
                <div class="space-y-4">
                    {% for allocation in recent_resource_allocations %}
                    <div class="border-l-4 border-green-500 pl-4 py-2">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-semibold text-gray-800">{{ allocation.resource.name }}</h3>
                                <p class="text-sm text-gray-600">{{ allocation.event.title }}</p>
                                <p class="text-xs text-gray-500">
                                    ğŸ“… {{ allocation.start_date|date:"M d" }} - {{ allocation.end_date|date:"M d, Y" }}
                                </p>
                            </div>
                            <div class="text-right">
                                <span class="px-2 py-1 text-xs rounded-full
                                    {% if allocation.status == 'confirmed' %}bg-green-100 text-green-800
                                    {% elif allocation.status == 'delivered' %}bg-blue-100 text-blue-800
                                    {% elif allocation.status == 'requested' %}bg-yellow-100 text-yellow-800
                                    {% else %}bg-gray-100 text-gray-800{% endif %}">
                                    {{ allocation.get_status_display }}
                                </span>
                                <p class="text-sm font-semibold text-green-600 mt-1">K{{ allocation.total_cost|floatformat:0 }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-8">No recent resource allocations</p>
            {% endif %}
        </div>
    </div>

    <!-- Resource Utilization -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“Š Resource Utilization Today</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            {% for util in resource_utilization %}
            <div class="bg-gray-50 rounded-lg p-4">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="font-semibold text-gray-800">
                        {% if util.type == 'sound' %}ğŸµ
                        {% elif util.type == 'lighting' %}ğŸ’¡
                        {% elif util.type == 'stage' %}ğŸ­
                        {% elif util.type == 'seating' %}ğŸª‘
                        {% elif util.type == 'security' %}ğŸ›¡ï¸
                        {% elif util.type == 'catering' %}ğŸ½ï¸
                        {% elif util.type == 'transport' %}ğŸšŒ
                        {% else %}ğŸ”§{% endif %}
                        {{ util.display_name }}
                    </h3>
                </div>
                
                <div class="mb-2">
                    <div class="flex justify-between text-sm text-gray-600">
                        <span>{{ util.allocated }}/{{ util.total }} in use</span>
                        <span>{{ util.utilization_rate|floatformat:0 }}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full" 
                             style="width: {{ util.utilization_rate }}%"></div>
                    </div>
                </div>
                
                <p class="text-xs text-gray-500">
                    {{ util.total }} total resources available
                </p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Venue Capacity Overview -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸŸï¸ Venue Capacity Overview</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for venue_data in venue_capacity_data %}
            <div class="border rounded-lg p-4 hover:shadow-md transition duration-300">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-semibold text-gray-800">{{ venue_data.venue.name }}</h3>
                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                        {{ venue_data.venue.capacity|floatformat:0 }} capacity
                    </span>
                </div>
                
                <p class="text-sm text-gray-600 mb-2">{{ venue_data.venue.address|truncatechars:40 }}</p>
                
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">This month:</span>
                    <span class="font-semibold text-green-600">{{ venue_data.bookings_this_month }} booking{{ venue_data.bookings_this_month|pluralize }}</span>
                </div>
                
                <div class="mt-2">
                    <span class="text-xs text-gray-500">Rate: K{{ venue_data.venue.hourly_rate|floatformat:0 }}/hr</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Upcoming Events -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“… Upcoming Events Requiring Facilities</h2>
        {% if upcoming_events %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for event in upcoming_events %}
                <div class="border rounded-lg p-4 hover:shadow-md transition duration-300">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold text-gray-800">{{ event.title }}</h3>
                        <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">
                            {{ event.category.name }}
                        </span>
                    </div>
                    
                    <p class="text-sm text-gray-600 mb-2">ğŸ“ {{ event.location }}</p>
                    <p class="text-sm text-gray-600 mb-2">ğŸ“… {{ event.date|date:"M d, Y" }}</p>
                    
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span>{{ event.total_seats_left }} seats left</span>
                        <span>{{ event.bookings.count }} booking{{ event.bookings.count|pluralize }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-gray-500 text-center py-8">No upcoming events</p>
        {% endif %}
    </div>

    <!-- Quick Actions -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
        <a href="{% url 'events:venues_list' %}" 
           class="bg-blue-600 text-white text-center py-4 px-6 rounded-lg hover:bg-blue-700 transition duration-300">
            <div class="text-2xl mb-2">ğŸ¢</div>
            <div class="font-semibold">Browse Venues</div>
            <div class="text-sm opacity-90">View available venues</div>
        </a>
        
        <a href="{% url 'events:resources_list' %}" 
           class="bg-green-600 text-white text-center py-4 px-6 rounded-lg hover:bg-green-700 transition duration-300">
            <div class="text-2xl mb-2">ğŸ”§</div>
            <div class="font-semibold">Browse Resources</div>
            <div class="text-sm opacity-90">View available resources</div>
        </a>
        
        {% if user.is_staff %}
        <a href="/admin/" 
           class="bg-purple-600 text-white text-center py-4 px-6 rounded-lg hover:bg-purple-700 transition duration-300">
            <div class="text-2xl mb-2">âš™ï¸</div>
            <div class="font-semibold">Admin Panel</div>
            <div class="text-sm opacity-90">Full system management</div>
        </a>
        {% else %}
        <a href="{% url 'events:events_list' %}" 
           class="bg-orange-600 text-white text-center py-4 px-6 rounded-lg hover:bg-orange-700 transition duration-300">
            <div class="text-2xl mb-2">ğŸ«</div>
            <div class="font-semibold">Browse Events</div>
            <div class="text-sm opacity-90">Find events to attend</div>
        </a>
        {% endif %}
    </div>
</div>
{% endblock %}