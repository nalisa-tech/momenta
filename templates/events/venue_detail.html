{% extends 'base.html' %}
{% load static %}

{% block title %}{{ venue.name }} - Momenta{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Venue Header -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-700 text-white rounded-lg p-8 mb-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2">
                <h1 class="text-4xl font-bold mb-4">üè¢ {{ venue.name }}</h1>
                <p class="text-xl text-blue-100 mb-4">üìç {{ venue.address }}</p>
                
                <!-- Key Stats -->
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold">{{ venue.capacity|floatformat:0 }}</div>
                        <div class="text-sm text-blue-100">Max Capacity</div>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold">K{{ venue.hourly_rate|floatformat:0 }}</div>
                        <div class="text-sm text-blue-100">Per Hour</div>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold">{{ total_bookings }}</div>
                        <div class="text-sm text-blue-100">Total Bookings</div>
                    </div>
                </div>
            </div>
            
            <!-- Contact Card -->
            <div class="bg-white bg-opacity-10 rounded-lg p-6">
                <h3 class="text-xl font-bold mb-4">üìû Contact Information</h3>
                {% if venue.contact_person %}
                    <p class="mb-2"><strong>Contact Person:</strong> {{ venue.contact_person }}</p>
                {% endif %}
                {% if venue.contact_phone %}
                    <p class="mb-2"><strong>Phone:</strong> 
                        <a href="tel:{{ venue.contact_phone }}" class="text-blue-200 hover:text-white">{{ venue.contact_phone }}</a>
                    </p>
                {% endif %}
                {% if venue.contact_email %}
                    <p class="mb-4"><strong>Email:</strong> 
                        <a href="mailto:{{ venue.contact_email }}" class="text-blue-200 hover:text-white">{{ venue.contact_email }}</a>
                    </p>
                {% endif %}
                
                {% if venue.contact_phone %}
                <a href="tel:{{ venue.contact_phone }}" 
                   class="block w-full bg-green-600 text-white text-center py-2 px-4 rounded-md hover:bg-green-700 transition duration-300">
                    üìû Call Now
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Facilities -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üèóÔ∏è Facilities & Amenities</h2>
                <div class="prose max-w-none">
                    <p class="text-gray-700 leading-relaxed">{{ venue.facilities }}</p>
                </div>
            </div>

            <!-- Upcoming Bookings -->
            {% if upcoming_bookings %}
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìÖ Upcoming Bookings</h2>
                <div class="space-y-4">
                    {% for booking in upcoming_bookings %}
                    <div class="border-l-4 border-blue-500 pl-4 py-2">
                        <h3 class="font-semibold text-gray-800">{{ booking.event.title }}</h3>
                        <p class="text-sm text-gray-600">
                            üìÖ {{ booking.start_datetime|date:"M d, Y" }} at {{ booking.start_datetime|time:"g:i A" }}
                            - {{ booking.end_datetime|time:"g:i A" }}
                        </p>
                        <p class="text-sm text-gray-600">
                            üí∞ K{{ booking.total_cost|floatformat:0 }} 
                            <span class="ml-2 px-2 py-1 text-xs rounded-full
                                {% if booking.status == 'confirmed' %}bg-green-100 text-green-800
                                {% elif booking.status == 'pending' %}bg-yellow-100 text-yellow-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ booking.get_status_display }}
                            </span>
                        </p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Availability Calendar -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìÖ Availability Calendar (Next 30 Days)</h2>
                <div class="grid grid-cols-7 gap-2">
                    <!-- Calendar Headers -->
                    <div class="text-center font-semibold text-gray-600 py-2">Sun</div>
                    <div class="text-center font-semibold text-gray-600 py-2">Mon</div>
                    <div class="text-center font-semibold text-gray-600 py-2">Tue</div>
                    <div class="text-center font-semibold text-gray-600 py-2">Wed</div>
                    <div class="text-center font-semibold text-gray-600 py-2">Thu</div>
                    <div class="text-center font-semibold text-gray-600 py-2">Fri</div>
                    <div class="text-center font-semibold text-gray-600 py-2">Sat</div>
                    
                    <!-- Calendar Days -->
                    {% for day in availability_calendar %}
                    <div class="text-center p-2 rounded-md text-sm
                        {% if day.available %}
                            bg-green-100 text-green-800 hover:bg-green-200
                        {% else %}
                            bg-red-100 text-red-800
                        {% endif %}"
                        title="{% if day.available %}Available{% else %}{{ day.bookings_count }} booking{{ day.bookings_count|pluralize }}{% endif %}">
                        {{ day.date.day }}
                        {% if not day.available %}
                            <div class="text-xs">{{ day.bookings_count }}</div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                <div class="mt-4 flex justify-center space-x-6 text-sm">
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-green-100 rounded mr-2"></div>
                        <span>Available</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-red-100 rounded mr-2"></div>
                        <span>Booked</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Quick Actions -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">‚ö° Quick Actions</h3>
                <div class="space-y-3">
                    {% if venue.contact_phone %}
                    <a href="tel:{{ venue.contact_phone }}" 
                       class="block w-full bg-green-600 text-white text-center py-2 px-4 rounded-md hover:bg-green-700 transition duration-300">
                        üìû Call Venue
                    </a>
                    {% endif %}
                    
                    {% if venue.contact_email %}
                    <a href="mailto:{{ venue.contact_email }}?subject=Venue Booking Inquiry - {{ venue.name }}" 
                       class="block w-full bg-blue-600 text-white text-center py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">
                        ‚úâÔ∏è Send Email
                    </a>
                    {% endif %}
                    
                    <a href="{% url 'events:venues_list' %}" 
                       class="block w-full bg-gray-600 text-white text-center py-2 px-4 rounded-md hover:bg-gray-700 transition duration-300">
                        üè¢ Browse Other Venues
                    </a>
                </div>
            </div>

            <!-- Venue Statistics -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">üìä Venue Statistics</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Total Bookings:</span>
                        <span class="font-semibold">{{ total_bookings }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Total Revenue:</span>
                        <span class="font-semibold text-green-600">K{{ total_revenue|floatformat:0 }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Hourly Rate:</span>
                        <span class="font-semibold">K{{ venue.hourly_rate|floatformat:0 }}/hr</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Max Capacity:</span>
                        <span class="font-semibold">{{ venue.capacity|floatformat:0 }}</span>
                    </div>
                </div>
            </div>

            <!-- Pricing Calculator -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">üí∞ Pricing Calculator</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Event Duration (hours)</label>
                        <input type="number" id="duration" value="4" min="1" max="24" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Setup Time (hours)</label>
                        <input type="number" id="setup" value="2" min="0" max="12" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cleanup Time (hours)</label>
                        <input type="number" id="cleanup" value="1" min="0" max="12" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center text-lg font-bold">
                            <span>Estimated Total:</span>
                            <span id="total-cost" class="text-green-600">K{{ venue.hourly_rate|floatformat:0 }}</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Based on hourly rate of K{{ venue.hourly_rate|floatformat:0 }}/hr</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Pricing calculator
function updateCost() {
    const duration = parseFloat(document.getElementById('duration').value) || 0;
    const setup = parseFloat(document.getElementById('setup').value) || 0;
    const cleanup = parseFloat(document.getElementById('cleanup').value) || 0;
    const hourlyRate = {{ venue.hourly_rate }};
    
    const totalHours = duration + setup + cleanup;
    const totalCost = totalHours * hourlyRate;
    
    document.getElementById('total-cost').textContent = 'K' + totalCost.toLocaleString();
}

// Add event listeners
document.getElementById('duration').addEventListener('input', updateCost);
document.getElementById('setup').addEventListener('input', updateCost);
document.getElementById('cleanup').addEventListener('input', updateCost);

// Initial calculation
updateCost();
</script>
{% endblock %}